{% extends 'base.html' %}


{% block content %}

<div class="container-fluid">
<div class="row">
<div class="col-xs-6 col-md-4">
  <form id="airport-search-form" method="GET" class="form-inline">
    <div class="typeahead__container">
        <div class="typeahead__field">
            <span class="typeahead__query">
                <input class="js-typeahead"
                       id="airport-search-field"
                       type="search"
                       autocomplete="off"
                       placeholder="From">
            </span>  </div></div></div>

<div class="col-xs-1">
    <input type="submit" id="airport-search" class="btn btn-default">
    </div>
</div>
<br>
<div id="map"></div>

</div>
{% endblock %}

{% block javascript %}

<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBUPJFt0VRwL6XWJFm9_WnjDgNBb_d_MQg&callback=initMap"></script>

<script>

var airfares = {{ airfares|tojson|safe }};
var airport_latlngs = {{ airport_latlngs|tojson|safe }};

function initMap() {
    var originalMapCenter = new google.maps.LatLng(14.0583, 108.2772);
    map = new google.maps.Map(document.getElementById('map'), {
        center: originalMapCenter,
        zoom: 3,
        });
};

function newCenter() {
    var mapCenter = new google.maps.LatLng(airport_latlngs[airport][0], airport_latlngs[airport][1]);
    newMap = new google.maps.Map(document.getElementById('map'), {
        center: mapCenter,
        zoom: 4,
        });
};

function loadDestinations(evt) {
    evt.preventDefault();

    // not declaring var before so airport is globally available
    airport = $('#airport-search-field').val().slice(0, 3);
    var m = airfares[airport];

    // var image = '/static/airport.svg';
    newCenter();

    for (i = 0; i < m.length; i++) {

        var name = m[i].city_name;
        var avgPrice = m[i].avg_price;
        var between = ": Average Price $";
        var cheapMonth = m[i].cheapest_month;
        var spot = new google.maps.LatLng(m[i].arrival_lat, m[i].arrival_lng);

        var marker = new google.maps.Marker({
            position: spot,
            map: newMap,
            title: name.concat(between,avgPrice),
        });

    };
};

$('#airport-search-form').on('submit', loadDestinations);

</script>


{% endblock %}
